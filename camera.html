<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Snappics - Take Photos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400;500;600&family=Poppins:wght@700;800&display=swap" rel="stylesheet" />
    <style>
        .font-playfair { font-family: 'Playfair Display', serif; }
        .font-montserrat { font-family: 'Montserrat', sans-serif; }
        .font-poppins { font-family: 'Poppins', sans-serif; }
        .btn-gradient { background: linear-gradient(180deg, #BFC5E8 0%, #98A2CC 33%, #8592BB 66%, #7B81AA 100%); }
        .btn-disabled { opacity: 0.5; cursor: not-allowed; pointer-events: none; }
        * { transition: transform 0.2s, opacity 0.2s; }
        video { transform: scaleX(-1); }

        /* Constrain video size on mobile */
        .camera-container {
            width: 100%;
            max-width: 640px; /* Max width for desktop */
            min-width: 320px; /* Min width for very small phones */
        }

        /* Specific sizing for mobile in portrait mode */
        @media (max-width: 768px) and (orientation: portrait) {
            .camera-container {
                width: 85vw; /* 85% of viewport width */
                max-width: 500px; /* Don't exceed 500px on mobile portrait */
                min-width: 300px; /* Minimum 300px */
            }
        }

        /* Sizing for mobile in landscape mode */
        @media (max-width: 768px) and (orientation: landscape) {
            .camera-container {
                width: 60vh; /* 60% of viewport height to keep it proportional */
                max-width: 640px;
                min-width: 400px;
            }
        }

        #flashOverlay {
            position: fixed;
            inset: 0;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 50;
            transition: none;
        }
        #flashOverlay.flash {
            animation: flashEffect 0.4s ease-out forwards;
        }
        @keyframes flashEffect {
            0%   { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body class="font-montserrat min-h-screen bg-[linear-gradient(120deg,#A3C9E2_30%,#9618F7_100%)] flex flex-col">

    <div id="flashOverlay"></div>

    <div class="flex-1 flex flex-col items-center justify-center p-4">
        <div id="photoCounter" class="font-montserrat text-white text-lg md:text-xl font-semibold mb-4">
            Photo 1 of 4
        </div>

        <div class="relative camera-container">
            <video id="camera" autoplay playsinline class="rounded-2xl shadow-2xl w-full"></video>

            <div id="countdownOverlay" class="hidden absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-2xl">
                <div id="countdownText" class="font-poppins text-white text-6xl md:text-9xl font-extrabold animate-pulse">3</div>
            </div>

            <canvas id="captureCanvas" class="hidden"></canvas>
        </div>

        <div class="flex gap-2 mt-6">
            <div id="dot0" class="w-3 h-3 md:w-4 md:h-4 rounded-full bg-gray-600"></div>
            <div id="dot1" class="w-3 h-3 md:w-4 md:h-4 rounded-full bg-gray-600"></div>
            <div id="dot2" class="w-3 h-3 md:w-4 md:h-4 rounded-full bg-gray-600"></div>
            <div id="dot3" class="w-3 h-3 md:w-4 md:h-4 rounded-full bg-gray-600"></div>
        </div>

        <button id="takePhotoBtn" onclick="startPhotoSequence()" class="btn-gradient hover:scale-110 mt-6 text-black px-12 md:px-20 py-3 md:py-4 rounded-full text-lg md:text-xl font-semibold shadow-lg">
            Take Photos
        </button>
    </div>

    <footer class="bg-[#1F0A50] py-5 px-4 md:px-12 mt-auto">
        <div class="flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="text-sm md:text-base font-[Montserrat] text-white text-center md:text-left">
                2026 Â© gemiilorya. All Rights Reserved.
            </div>
            <div class="text-white text-sm md:text-base font-[Montserrat] flex flex-wrap gap-4 md:gap-8 items-center justify-center">
                <a href="https://github.com/gemiilorya" class="hover:underline">Github</a>
                <a href="https://www.linkedin.com/in/gloria-marie-lamsin/" class="hover:underline">Linkedin</a> 
                <a href="#" class="hover:underline">Portfolio</a> 
                <a href="mailto:gloriamarielamsin@gmail.com">
                    <button class="px-6 md:px-10 py-2 md:py-4 font-[Montserrat] text-white hover:scale-110 text-sm md:text-base bg-[#D1C1F7] rounded-full shadow-md">
                        Contact Me
                    </button>
                </a> 
            </div>
        </div>
    </footer>

    <script>
        let capturedImages = [];

        window.onload = function () {
            startCamera();
            updateUI();
        };

        function updateUI() {
            document.getElementById('photoCounter').textContent = 'Photo ' + (capturedImages.length + 1) + ' of 4';
            ['dot0', 'dot1', 'dot2', 'dot3'].forEach((id, i) => {
                const dot = document.getElementById(id);
                if (i < capturedImages.length) {
                    dot.classList.remove('bg-gray-600');
                    dot.classList.add('bg-green-500');
                }
            });
        }

        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'user' },
                    audio: false
                });
                document.getElementById('camera').srcObject = stream;
            } catch (err) {
                alert('Could not access camera. Please allow camera permissions and try again.');
                console.error(err);
            }
        }

        function stopCamera() {
            const video = document.getElementById('camera');
            if (video.srcObject) {
                video.srcObject.getTracks().forEach(track => track.stop());
                video.srcObject = null;
            }
        }

        async function startPhotoSequence() {
            const btn = document.getElementById('takePhotoBtn');
            btn.classList.add('btn-disabled');

            for (let i = 0; i < 4; i++) {
                await startCountdown();
                triggerFlash();
                capturePhoto();
                if (i < 3) {
                    await pauseBetweenPhotos();
                }
            }

            await new Promise(resolve => setTimeout(resolve, 500));
            stopCamera();
            window.location.href = 'result.html';
        }

        function triggerFlash() {
            const flash = document.getElementById('flashOverlay');
            flash.classList.remove('flash');
            void flash.offsetWidth;
            flash.classList.add('flash');
        }

        function startCountdown() {
            return new Promise((resolve) => {
                let count = 3;
                document.getElementById('countdownText').textContent = count;
                document.getElementById('countdownOverlay').classList.remove('hidden');

                const interval = setInterval(() => {
                    count--;
                    if (count > 0) {
                        document.getElementById('countdownText').textContent = count;
                    } else {
                        clearInterval(interval);
                        document.getElementById('countdownOverlay').classList.add('hidden');
                        resolve();
                    }
                }, 1000);
            });
        }

        function capturePhoto() {
            const video = document.getElementById('camera');
            const canvas = document.getElementById('captureCanvas');
            const ctx = canvas.getContext('2d');

            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            ctx.translate(canvas.width, 0);
            ctx.scale(-1, 1);
            ctx.drawImage(video, 0, 0);

            const imgData = canvas.toDataURL('image/png');
            capturedImages.push(imgData);

            sessionStorage.setItem('snappics_photos', JSON.stringify(capturedImages));

            document.getElementById('dot' + (capturedImages.length - 1)).classList.remove('bg-gray-600');
            document.getElementById('dot' + (capturedImages.length - 1)).classList.add('bg-green-500');

            document.getElementById('photoCounter').textContent = 'Photo ' + (capturedImages.length + 1) + ' of 4';
        }

        function pauseBetweenPhotos() {
            return new Promise((resolve) => {
                setTimeout(resolve, 1000);
            });
        }
    </script>
</body>
</html>